services:
  desktop:
    image: ledanghuy/workspace:desktop-micro
    privileged: true
    security_opt:
      - seccomp:unconfined
    environment:
      PUID: 0
      PGID: 0
      START_DOCKER: false
      PASSWORD: ${PASSWORD}
      FM_HOME: /workspace
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/lib/docker:/var/lib/docker
      - /mnt:/mnt
      - /:/hostmachine
    network_mode: host
    shm_size: 4gb
    restart: always

  serveo:
    image: docker:latest
    restart: always
    working_dir: /conpose
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./:/compose
    entrypoint: docker compose exec desktop bash -c "chmod 644 /root/.ssh/config && autossh -M 0 -R 80:localhost:3000 serveo.net"
